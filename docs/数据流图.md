# 校内二手物品交易平台数据流图

## 项目信息
- **项目名称：** 校内二手物品交易平台
- **组员：** 肖一涵、刘鑫宇
- **文档类型：** 数据流图设计
- **创建时间：** 2024年

---

## 1. 顶层数据流图（0层DFD）

```mermaid
graph TB
    %% 外部实体
    User[用户<br/>买家/卖家]
    Admin[系统管理员]
    PaymentSystem[支付系统]
    
    %% 系统
    System[校内二手物品<br/>交易平台<br/>0]
    
    %% 数据流
    User -->|用户注册信息| System
    User -->|登录凭证| System
    User -->|商品发布信息| System
    User -->|搜索条件| System
    User -->|订单信息| System
    User -->|消息内容| System
    User -->|收藏操作| System
    User -->|地址信息| System
    
    System -->|注册结果| User
    System -->|用户信息| User
    System -->|商品列表| User
    System -->|搜索结果| User
    System -->|订单状态| User
    System -->|消息通知| User
    System -->|收藏列表| User
    System -->|地址列表| User
    
    System -->|支付请求| PaymentSystem
    PaymentSystem -->|支付结果| System
    
    Admin -->|管理指令| System
    System -->|系统状态| Admin
```

## 2. 一层数据流图（1层DFD）

```mermaid
graph TB
    %% 外部实体
    User[用户]
    PaymentSystem[支付系统]
    
    %% 处理过程
    P1[1.0<br/>用户管理]
    P2[2.0<br/>商品管理]
    P3[3.0<br/>交易管理]
    P4[4.0<br/>消息管理]
    P5[5.0<br/>收藏管理]
    P6[6.0<br/>地址管理]
    
    %% 数据存储
    D1[(D1 用户信息)]
    D2[(D2 商品信息)]
    D3[(D3 订单信息)]
    D4[(D4 消息信息)]
    D5[(D5 收藏信息)]
    D6[(D6 地址信息)]
    D7[(D7 分类信息)]
    
    %% 用户管理相关数据流
    User -->|注册信息| P1
    User -->|登录凭证| P1
    P1 -->|注册结果| User
    P1 -->|登录状态| User
    P1 <-->|用户数据| D1
    
    %% 商品管理相关数据流
    User -->|商品发布信息| P2
    User -->|搜索条件| P2
    P2 -->|商品列表| User
    P2 -->|商品详情| User
    P2 <-->|商品数据| D2
    P2 <-->|分类数据| D7
    P1 -->|用户验证| P2
    
    %% 交易管理相关数据流
    User -->|下单信息| P3
    P3 -->|订单状态| User
    P3 <-->|订单数据| D3
    P3 -->|支付请求| PaymentSystem
    PaymentSystem -->|支付结果| P3
    P1 -->|用户验证| P3
    P2 -->|商品信息| P3
    P6 -->|地址信息| P3
    
    %% 消息管理相关数据流
    User -->|消息内容| P4
    P4 -->|消息列表| User
    P4 <-->|消息数据| D4
    P1 -->|用户验证| P4
    P2 -->|商品信息| P4
    
    %% 收藏管理相关数据流
    User -->|收藏操作| P5
    P5 -->|收藏列表| User
    P5 <-->|收藏数据| D5
    P1 -->|用户验证| P5
    P2 -->|商品信息| P5
    
    %% 地址管理相关数据流
    User -->|地址信息| P6
    P6 -->|地址列表| User
    P6 <-->|地址数据| D6
    P1 -->|用户验证| P6
```

## 3. 二层数据流图 - 用户管理（1.0分解）

```mermaid
graph TB
    %% 外部实体
    User[用户]
    
    %% 子处理过程
    P11[1.1<br/>用户注册]
    P12[1.2<br/>用户登录]
    P13[1.3<br/>用户认证]
    P14[1.4<br/>用户信息管理]
    
    %% 数据存储
    D1[(D1 用户信息)]
    
    %% 数据流
    User -->|注册信息| P11
    P11 -->|注册结果| User
    P11 -->|新用户数据| D1
    
    User -->|登录凭证| P12
    P12 -->|登录状态| User
    P12 <-->|用户验证| D1
    
    User -->|认证信息| P13
    P13 -->|认证结果| User
    P13 <-->|认证状态| D1
    
    User -->|修改信息| P14
    P14 -->|更新结果| User
    P14 <-->|用户数据| D1
    
    P12 -->|登录验证| P13
    P13 -->|认证状态| P14
```

## 4. 二层数据流图 - 商品管理（2.0分解）

```mermaid
graph TB
    %% 外部实体
    User[用户]
    
    %% 子处理过程
    P21[2.1<br/>商品发布]
    P22[2.2<br/>商品浏览]
    P23[2.3<br/>商品搜索]
    P24[2.4<br/>分类管理]
    
    %% 数据存储
    D2[(D2 商品信息)]
    D7[(D7 分类信息)]
    
    %% 外部处理
    P1[1.0 用户管理]
    
    %% 数据流
    User -->|商品信息| P21
    P21 -->|发布结果| User
    P21 -->|商品数据| D2
    P1 -->|用户验证| P21
    
    User -->|浏览请求| P22
    P22 -->|商品列表| User
    P22 <-->|商品数据| D2
    
    User -->|搜索条件| P23
    P23 -->|搜索结果| User
    P23 <-->|商品数据| D2
    P23 <-->|分类数据| D7
    
    P24 <-->|分类数据| D7
    P21 -->|分类需求| P24
    P22 -->|分类信息| P24
```

## 5. 二层数据流图 - 交易管理（3.0分解）

```mermaid
graph TB
    %% 外部实体
    User[用户]
    PaymentSystem[支付系统]
    
    %% 子处理过程
    P31[3.1<br/>订单创建]
    P32[3.2<br/>支付处理]
    P33[3.3<br/>订单跟踪]
    P34[3.4<br/>交易完成]
    
    %% 数据存储
    D3[(D3 订单信息)]
    
    %% 外部处理
    P1[1.0 用户管理]
    P2[2.0 商品管理]
    P6[6.0 地址管理]
    
    %% 数据流
    User -->|下单信息| P31
    P31 -->|订单确认| User
    P31 -->|订单数据| D3
    P1 -->|用户验证| P31
    P2 -->|商品信息| P31
    P6 -->|地址信息| P31
    
    P31 -->|支付信息| P32
    P32 -->|支付请求| PaymentSystem
    PaymentSystem -->|支付结果| P32
    P32 <-->|支付状态| D3
    P32 -->|支付结果| User
    
    User -->|状态查询| P33
    P33 -->|订单状态| User
    P33 <-->|订单数据| D3
    
    P32 -->|完成信号| P34
    P34 <-->|订单数据| D3
    P34 -->|交易完成| User
```

## 6. 数据元素表

### 6.1 数据流定义

| 数据流名称 | 组成 | 说明 |
|-----------|------|------|
| 用户注册信息 | 学号+用户名+密码+真实姓名+手机号+邮箱 | 用户注册时提供的基本信息 |
| 登录凭证 | (用户名\|学号\|手机号)+密码 | 用户登录验证信息 |
| 商品发布信息 | 标题+描述+价格+图片+分类+地点 | 发布商品时的完整信息 |
| 搜索条件 | 关键词+分类+价格区间+排序方式 | 商品搜索的筛选条件 |
| 订单信息 | 商品ID+地址ID+支付方式+备注 | 创建订单的必要信息 |
| 消息内容 | 发送者ID+接收者ID+商品ID+内容+类型 | 用户间沟通的消息信息 |
| 收藏操作 | 用户ID+商品ID+操作类型+备注 | 收藏相关的操作信息 |
| 地址信息 | 收件人+电话+省市区+详细地址+类型 | 收货地址的完整信息 |

### 6.2 数据存储定义

| 数据存储 | 组成 | 说明 |
|----------|------|------|
| D1 用户信息 | 用户ID+学号+用户名+密码+个人信息+状态 | 存储所有用户的基本信息和状态 |
| D2 商品信息 | 商品ID+用户ID+分类ID+商品详情+状态 | 存储所有发布的商品信息 |
| D3 订单信息 | 订单ID+买家ID+卖家ID+商品ID+交易详情 | 存储所有交易订单信息 |
| D4 消息信息 | 消息ID+发送者ID+接收者ID+内容+状态 | 存储用户间的沟通消息 |
| D5 收藏信息 | 收藏ID+用户ID+商品ID+收藏时间 | 存储用户的商品收藏记录 |
| D6 地址信息 | 地址ID+用户ID+地址详情+类型 | 存储用户的收货地址信息 |
| D7 分类信息 | 分类ID+分类名称+父分类ID+描述 | 存储商品分类的层级结构 |

### 6.3 处理过程定义

| 处理过程 | 输入 | 输出 | 处理逻辑 |
|----------|------|------|----------|
| 1.1 用户注册 | 注册信息 | 注册结果+用户ID | 验证信息格式→检查重复→创建账户→发送确认 |
| 1.2 用户登录 | 登录凭证 | 登录状态+会话信息 | 验证凭证→检查状态→创建会话→记录日志 |
| 2.1 商品发布 | 商品信息+用户验证 | 发布结果+商品ID | 验证权限→检查信息→保存商品→更新索引 |
| 2.3 商品搜索 | 搜索条件 | 搜索结果 | 解析条件→执行搜索→排序结果→返回列表 |
| 3.1 订单创建 | 下单信息+验证信息 | 订单确认 | 验证商品→检查库存→创建订单→锁定商品 |
| 3.2 支付处理 | 支付信息 | 支付结果 | 调用支付接口→处理回调→更新状态→通知用户 |

## 7. 数据流图设计说明

### 7.1 设计原则
1. **分层设计**：采用自顶向下的分层设计方法，逐步细化
2. **数据守恒**：确保每层DFD的数据流保持一致性
3. **功能内聚**：每个处理过程具有单一、明确的功能
4. **接口简洁**：处理过程间的数据流简洁明了

### 7.2 符号说明
- **圆角矩形**：外部实体（用户、外部系统）
- **圆形**：处理过程（系统功能）
- **开口矩形**：数据存储（数据库表）
- **箭头**：数据流（数据传递方向）

### 7.3 数据流特点
1. **双向数据流**：用户与系统间存在交互式数据流
2. **数据验证**：所有输入数据都经过验证处理
3. **状态管理**：系统维护各种业务对象的状态
4. **异步处理**：支付等外部接口采用异步处理

### 7.4 系统边界
- **内部处理**：用户管理、商品管理、交易管理、消息管理、收藏管理、地址管理
- **外部接口**：支付系统接口
- **数据边界**：用户输入验证、系统输出格式化

---

## 8. DFD与数据库设计的对应关系

| DFD数据存储 | 对应数据库表 | 主要字段 |
|-------------|--------------|----------|
| D1 用户信息 | user | user_id, student_id, username, password |
| D2 商品信息 | item | item_id, user_id, category_id, title, price |
| D3 订单信息 | order | order_id, buyer_id, seller_id, item_id |
| D4 消息信息 | message | message_id, sender_id, receiver_id, content |
| D5 收藏信息 | wishlist | wishlist_id, user_id, item_id |
| D6 地址信息 | address | address_id, user_id, detailed_address |
| D7 分类信息 | category | category_id, category_name, parent_category_id |

---

**文档创建时间：** 2024年  
**最后更新时间：** 2024年  
**文档状态：** 初版完成  
**审核状态：** 待审核